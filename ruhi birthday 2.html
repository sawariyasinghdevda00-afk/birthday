<!-- Background Layers -->
<div class="aurora-bg"></div>
<div id="three-js-container" class="fixed top-0 left-0 w-full h-full z-[-1]"></div>

<!-- Progress Bar -->
<div class="fixed top-5 left-1/2 -translate-x-1/2 w-1/3 max-w-sm h-2 rounded-full progress-bar-track">
    <div id="progressBar" class="h-full rounded-full progress-bar-fill" style="width: 0%;"></div>
</div>

<main class="w-full max-w-xl mx-auto">
    <!-- Step 1: The Grand Welcome -->
    <section id="step-1" class="step text-center glass-card rounded-2xl p-8 md:p-12 flex flex-col items-center">
        <div class="text-7xl animate-pulse">‚ù§Ô∏è</div>
        <h1 class="text-5xl font-bold mt-4 mb-2 text-gradient">Hey Beautiful,</h1>
        <p class="text-slate-300 mb-8">I built a little world for you, just to bring a smile to your face on your special day.</p>
        <button class="gradient-btn font-bold text-white py-3 px-8 rounded-full" onclick="nextStep(2)">Let's Begin</button>
    </section>

    <!-- Step 2: The Core Message -->
    <section id="step-2" class="step text-center glass-card rounded-2xl p-8 md:p-12 flex-col items-center hidden">
        <div class="text-7xl">üéâ</div>
        <h1 class="text-5xl font-bold mt-4 mb-2 text-gradient">Happy Birthday!</h1>
        <p class="text-slate-300 mb-8">Another year of you making the world brighter. Your existence is a gift, and I'm so lucky to witness it.</p>
        <button class="gradient-btn font-bold text-white py-3 px-8 rounded-full" onclick="nextStep(3)">There's more...</button>
    </section>

    <!-- Step 3: The Reasons Why -->
    <section id="step-3" class="step text-center glass-card rounded-2xl p-8 md:p-12 flex-col items-center hidden">
        <h1 class="text-4xl font-bold mb-6 text-gradient">A Few Things I Adore About You</h1>
        <div class="bento-grid text-left w-full">
            <div class="bento-item-1 glass-card rounded-xl p-4">
                <h2 class="font-bold text-lg mb-1">‚ú® Your Unmatched Kindness</h2>
                <p class="text-sm text-slate-300">The genuine warmth you show to everyone is something truly rare and beautiful.</p>
            </div>
            <div class="bento-item-2 glass-card rounded-xl p-4">
                 <h2 class="font-bold text-lg mb-1">üòä That Smile</h2>
                 <p class="text-sm text-slate-300">It's a work of art.</p>
            </div>
            <div class="bento-item-3 glass-card rounded-xl p-4">
                <h2 class="font-bold text-lg mb-1">üåü Your Radiant Spirit</h2>
                <p class="text-sm text-slate-300">Your passion for life is infectious. Being around you makes everything feel more exciting and possible.</p>
            </div>
        </div>
        <button class="gradient-btn font-bold text-white py-3 px-8 rounded-full mt-8" onclick="nextStep(4)">Remember this?</button>
    </section>

    <!-- Step 4: The Shared Memory -->
    <section id="step-4" class="step text-center glass-card rounded-2xl p-8 md:p-12 flex-col items-center hidden">
        <h1 class="text-4xl font-bold mb-6 text-gradient">That One Time...</h1>
        <div class="polaroid" id="polaroid-container">
            <div class="polaroid-img-container">
                <img src="https://i.ibb.co/6Z6XgCg/crush.webp" alt="A shared memory" class="w-full h-auto rounded-sm">
            </div>
            <p class="text-black text-center mt-4 font-serif">Our favorite memory.</p>
        </div>
        <p class="text-slate-300 mt-8 mb-8">Every moment with you feels like a scene from a movie I'd watch on repeat.</p>
        <button class="gradient-btn font-bold text-white py-3 px-8 rounded-full" onclick="nextStep(5)">One last thing...</button>
    </section>

    <!-- Step 5: The Birthday Wish & Finale -->
    <section id="step-5" class="step text-center glass-card rounded-2xl p-8 md:p-12 flex-col items-center hidden">
        <div class="text-7xl">üéÇ</div>
        <h1 class="text-5xl font-bold mt-4 mb-2 text-gradient">My Wish For You</h1>
        <p class="text-slate-300 mb-8">May the next year bring you all the love, success, and pure happiness you so rightfully deserve. May your dreams soar higher than ever.</p>
        <div id="final-message-container" class="h-8">
             <p id="final-message" class="text-2xl text-pink-300 font-bold opacity-0 -translate-y-4"></p>
        </div>
        <button id="celebrate-btn" class="gradient-btn font-bold text-white py-3 px-8 rounded-full mt-4">Celebrate!</button>
    </section>
</main>

<script>
    let currentStep = 1;
    const totalSteps = 5;
    let hearts = [];
    let scene, camera, renderer;

    // --- Three.js 3D Hearts ---
    function initThreeJS() {
        const container = document.getElementById('three-js-container');
        
        // Scene
        scene = new THREE.Scene();
        
        // Camera
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 50;

        // Renderer
        renderer = new THREE.WebGLRenderer({ alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        container.appendChild(renderer.domElement);

        // Create Hearts
        const heartShape = new THREE.Shape();
        heartShape.moveTo( 25, 25 );
        heartShape.bezierCurveTo( 25, 25, 20, 0, 0, 0 );
        heartShape.bezierCurveTo( -30, 0, -30, 35, -30, 35 );
        heartShape.bezierCurveTo( -30, 55, -10, 77, 25, 95 );
        heartShape.bezierCurveTo( 60, 77, 80, 55, 80, 35 );
        heartShape.bezierCurveTo( 80, 35, 80, 0, 50, 0 );
        heartShape.bezierCurveTo( 35, 0, 25, 25, 25, 25 );

        const extrudeSettings = { depth: 8, bevelEnabled: true, bevelSegments: 2, steps: 2, bevelSize: 1, bevelThickness: 1 };
        const geometry = new THREE.ExtrudeGeometry( heartShape, extrudeSettings );
        
        for (let i = 0; i < 25; i++) {
            const material = new THREE.MeshStandardMaterial({ color: new THREE.Color(`hsl(${340 + Math.random() * 20}, 100%, 75%)`), metalness: 0.5, roughness: 0.5 });
            const heart = new THREE.Mesh(geometry, material);
            
            heart.position.set(
                (Math.random() - 0.5) * 150,
                (Math.random() - 0.5) * 100,
                (Math.random() - 0.5) * 50
            );
            
            heart.rotation.set(
                Math.random() * Math.PI,
                Math.random() * Math.PI,
                Math.random() * Math.PI
            );

            const scale = Math.random() * 0.02 + 0.01;
            heart.scale.set(scale, scale, scale);
            
            heart.userData.initialY = heart.position.y;
            heart.userData.sineOffset = Math.random() * Math.PI * 2;

            hearts.push(heart);
            scene.add(heart);
        }
        
        // Lights
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);
        const pointLight = new THREE.PointLight(0xffffff, 1);
        pointLight.position.set(50, 50, 50);
        scene.add(pointLight);

        window.addEventListener('resize', onWindowResize, false);
        animate();
    }

    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function animate() {
        requestAnimationFrame(animate);

        hearts.forEach(heart => {
            heart.rotation.y += 0.005;
            heart.position.y = heart.userData.initialY + Math.sin(Date.now() * 0.001 + heart.userData.sineOffset) * 5;
        });
        
        renderer.render(scene, camera);
    }
    
    // --- Step Navigation & Animations ---
    function nextStep(step) {
        if (step > totalSteps) return;

        const currentSection = document.getElementById(`step-${currentStep}`);
        const nextSection = document.getElementById(`step-${step}`);
        
        const tl = gsap.timeline();
        tl.to(currentSection, { opacity: 0, scale: 0.9, duration: 0.5, ease: 'power2.in' })
          .set(currentSection, { display: 'none' })
          .set(nextSection, { display: 'flex', opacity: 0, y: 50 })
          .to(nextSection, { opacity: 1, y: 0, duration: 0.8, ease: 'power2.out' })
          .from(nextSection.children, { opacity: 0, y: 20, stagger: 0.1, duration: 0.5, ease: 'power2.out' }, '-=0.5');

        currentStep = step;
        updateProgressBar();
    }

    function updateProgressBar() {
        const progress = ((currentStep - 1) / (totalSteps -1)) * 100;
        gsap.to('#progressBar', { width: `${progress}%`, duration: 1, ease: 'power2.out' });
    }
    
    // --- Step 4: Polaroid Interaction ---
    const polaroid = document.getElementById('polaroid-container');
    polaroid.addEventListener('mousemove', (e) => {
        const rect = polaroid.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        const rotateX = (y / rect.height - 0.5) * -30; // Tilt up/down
        const rotateY = (x / rect.width - 0.5) * 30; // Tilt left/right
        
        gsap.to(polaroid.querySelector('.polaroid-img-container'), {
            transform: `rotateX(${rotateX}deg) rotateY(${rotateY}deg)`,
            duration: 0.5,
            ease: 'power1.out'
        });
    });

    polaroid.addEventListener('mouseleave', () => {
        gsap.to(polaroid.querySelector('.polaroid-img-container'), {
            transform: 'rotateX(0deg) rotateY(0deg)',
            duration: 0.5,
            ease: 'power1.out'
        });
    });


    // --- Step 5: Grand Finale ---
    document.getElementById('celebrate-btn').addEventListener('click', function() {
        this.disabled = true;
        gsap.to(this, { opacity: 0, duration: 0.5 });
        
        const finalMessage = document.getElementById('final-message');
        finalMessage.textContent = "Happy Birthday, my crush! ‚ù§Ô∏è";
        gsap.to(finalMessage, { opacity: 1, y: 0, duration: 1, ease: 'power2.out', delay: 0.5 });

        // Confetti explosion
        const duration = 5 * 1000;
        const animationEnd = Date.now() + duration;
        const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

        function randomInRange(min, max) {
          return Math.random() * (max - min) + min;
        }

        const interval = setInterval(function() {
          const timeLeft = animationEnd - Date.now();
          if (timeLeft <= 0) return clearInterval(interval);

          const particleCount = 50 * (timeLeft / duration);
          confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } });
          confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } });
          confetti({
              particleCount: 2,
              angle: 90,
              spread: 55,
              origin: { y: 0.6 },
              shapes: ['emoji'],
              shapeOptions: {
                  emoji: { value: ['‚ù§Ô∏è', 'üíñ', '‚ú®'] }
              }
          });
        }, 250);
        
        // 3D Hearts finale animation
        hearts.forEach(heart => {
            gsap.to(heart.position, {
                x: heart.position.x * 3,
                y: heart.position.y + 100,
                z: heart.position.z + 50,
                duration: 5,
                ease: 'power2.inOut'
            });
             gsap.to(heart.material, {
                opacity: 0,
                duration: 5,
                ease: 'power2.in'
            });
        });
    });

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
         // Initial animation for the first step
        gsap.from('#step-1', { opacity: 0, y: 50, duration: 1, ease: 'power2.out' });
        gsap.from('#step-1 > *', { opacity: 0, y: 20, stagger: 0.2, duration: 0.8, ease: 'power2.out', delay: 0.5 });
        initThreeJS();
    });

</script>